<!-- pages/admin/parking/parking.wxml -->
<view class="container">
  <!-- è½¦ä½çŠ¶æ€ -->
  <view class="parking-status card" wx:if="{{parkingStatus}}">
    <view class="status-item">
      <view class="status-value">{{parkingStatus.totalSpaces}}</view>
      <view class="status-label">æ€»è½¦ä½</view>
    </view>
    <view class="status-divider"></view>
    <view class="status-item">
      <view class="status-value text-success">{{parkingStatus.availableSpaces}}</view>
      <view class="status-label">ç©ºé—²</view>
    </view>
    <view class="status-divider"></view>
    <view class="status-item">
      <view class="status-value text-warning">{{parkingStatus.usedSpaces}}</view>
      <view class="status-label">å·²å ç”¨</view>
    </view>
  </view>

  <!-- æ‰‹åŠ¨ç™»è®°æŒ‰é’® -->
  <view class="register-btn" bindtap="showRegisterForm">
    + æ‰‹åŠ¨ç™»è®°è½¦è¾†
  </view>

  <!-- çŠ¶æ€ç­›é€‰ -->
  <scroll-view class="status-filter" scroll-x enable-flex>
    <view 
      class="status-item {{currentStatus === item.value ? 'active' : ''}}"
      wx:for="{{statusTabs}}"
      wx:key="value"
      bindtap="onStatusChange"
      data-status="{{item.value}}"
    >
      {{item.label}}
    </view>
  </scroll-view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <view class="record-list">
    <view 
      class="record-item card"
      wx:for="{{records}}"
      wx:key="_id"
    >
      <view class="record-header">
        <view class="plate-number">{{item.plateNumber}}</view>
        <view class="record-status {{item.statusClass}}">{{item.statusText}}</view>
      </view>
      
      <view class="record-info">
        <view class="info-row">
          <text class="info-label">ç±»å‹</text>
          <text class="info-value">{{item.typeText}}</text>
        </view>
        <view class="info-row" wx:if="{{item.purpose}}">
          <text class="info-label">è®¿é—®ç›®çš„</text>
          <text class="info-value">{{item.purpose}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">ç™»è®°æ—¶é—´</text>
          <text class="info-value">{{item.createTimeStr}}</text>
        </view>
        <view class="info-row" wx:if="{{item.entryTime}}">
          <text class="info-label">å…¥åœºæ—¶é—´</text>
          <text class="info-value">{{item.entryTimeStr}}</text>
        </view>
        <view class="info-row" wx:if="{{item.exitTime}}">
          <text class="info-label">å‡ºåœºæ—¶é—´</text>
          <text class="info-value">{{item.exitTimeStr}}</text>
        </view>
        <view class="info-row" wx:if="{{item.duration}}">
          <text class="info-label">åœè½¦æ—¶é•¿</text>
          <text class="info-value">{{item.durationStr}}</text>
        </view>
      </view>
      
      <view class="record-actions" wx:if="{{item.canConfirmEntry || item.canConfirmExit}}">
        <view 
          class="action-btn entry" 
          wx:if="{{item.canConfirmEntry}}"
          bindtap="onConfirmEntry" 
          data-id="{{item._id}}"
        >
          ç¡®è®¤å…¥åœº
        </view>
        <view 
          class="action-btn exit" 
          wx:if="{{item.canConfirmExit}}"
          bindtap="onConfirmExit" 
          data-id="{{item._id}}"
        >
          ç¡®è®¤å‡ºåœº
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-more" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- æ²¡æœ‰æ›´å¤š -->
  <view class="no-more" wx:if="{{!hasMore && records.length > 0}}">
    <text>â€” æ²¡æœ‰æ›´å¤šäº† â€”</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && records.length === 0}}">
    <view class="empty-icon">ğŸš—</view>
    <view class="empty-text">æš‚æ— åœè½¦è®°å½•</view>
  </view>

  <!-- ç™»è®°è¡¨å•å¼¹çª— -->
  <view class="form-modal" wx:if="{{showRegisterForm}}">
    <view class="form-mask" bindtap="hideRegisterForm"></view>
    <view class="form-content">
      <view class="form-header">
        <view class="form-title">æ‰‹åŠ¨ç™»è®°è½¦è¾†</view>
        <view class="form-close" bindtap="hideRegisterForm">Ã—</view>
      </view>
      
      <view class="form-body">
        <view class="form-group">
          <view class="form-label"><text class="required">*</text>è½¦ç‰Œå·</view>
          <input 
            class="form-input plate-input" 
            placeholder="è¯·è¾“å…¥è½¦ç‰Œå·"
            value="{{registerPlate}}"
            bindinput="onPlateInput"
            maxlength="8"
          />
        </view>
        
        <view class="form-group">
          <view class="form-label">è®¿é—®ç›®çš„</view>
          <input 
            class="form-input" 
            placeholder="è¯·è¾“å…¥è®¿é—®ç›®çš„"
            value="{{registerPurpose}}"
            bindinput="onPurposeInput"
          />
        </view>
      </view>
      
      <view class="form-footer">
        <view class="btn-cancel" bindtap="hideRegisterForm">å–æ¶ˆ</view>
        <view class="btn-save" bindtap="submitRegister">ç™»è®°</view>
      </view>
    </view>
  </view>
</view>
