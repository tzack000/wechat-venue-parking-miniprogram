<!-- pages/parking/records/records.wxml -->
<view class="container">
  <!-- å½“å‰åœ¨åœºè½¦è¾† -->
  <view class="current-parking" wx:if="{{currentParking.length > 0}}">
    <view class="section-title">å½“å‰åœ¨åœºè½¦è¾†</view>
    <view class="current-item card" wx:for="{{currentParking}}" wx:key="_id">
      <view class="plate-number">{{item.plateNumber}}</view>
      <view class="parking-info">
        <text>å…¥åœºæ—¶é—´: {{item.entryTimeStr}}</text>
        <text class="ml-10">å·²åœ: {{item.durationStr}}</text>
      </view>
      <view class="current-actions">
        <view class="action-btn exit" bindtap="onConfirmExit" data-id="{{item._id}}">
          ç¡®è®¤å‡ºåœº
        </view>
      </view>
    </view>
  </view>

  <!-- çŠ¶æ€ç­›é€‰ -->
  <scroll-view class="status-filter" scroll-x enable-flex>
    <view 
      class="status-item {{currentStatus === item.value ? 'active' : ''}}"
      wx:for="{{statusTabs}}"
      wx:key="value"
      bindtap="onStatusChange"
      data-status="{{item.value}}"
    >
      {{item.label}}
    </view>
  </scroll-view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <view class="record-list">
    <view 
      class="record-item card"
      wx:for="{{records}}"
      wx:key="_id"
    >
      <view class="record-header">
        <view class="plate-number">{{item.plateNumber}}</view>
        <view class="record-status {{item.statusClass}}">{{item.statusText}}</view>
      </view>
      
      <view class="record-info">
        <view class="info-row">
          <text class="info-label">ç±»å‹</text>
          <text class="info-value">{{item.typeText}}</text>
        </view>
        <view class="info-row" wx:if="{{item.type === 'reserve'}}">
          <text class="info-label">é¢„çº¦æ—¥æœŸ</text>
          <text class="info-value">{{item.reserveDate}} {{item.reserveStartTime}}</text>
        </view>
        <view class="info-row" wx:if="{{item.purpose}}">
          <text class="info-label">è®¿é—®ç›®çš„</text>
          <text class="info-value">{{item.purpose}}</text>
        </view>
        <view class="info-row">
          <text class="info-label">ç™»è®°æ—¶é—´</text>
          <text class="info-value">{{item.createTimeStr}}</text>
        </view>
        <view class="info-row" wx:if="{{item.entryTime}}">
          <text class="info-label">å…¥åœºæ—¶é—´</text>
          <text class="info-value">{{item.entryTimeStr}}</text>
        </view>
        <view class="info-row" wx:if="{{item.exitTime}}">
          <text class="info-label">å‡ºåœºæ—¶é—´</text>
          <text class="info-value">{{item.exitTimeStr}}</text>
        </view>
        <view class="info-row" wx:if="{{item.duration}}">
          <text class="info-label">åœè½¦æ—¶é•¿</text>
          <text class="info-value">{{item.durationStr}}</text>
        </view>
      </view>
      
      <view class="record-actions">
        <view 
          class="action-btn qrcode" 
          wx:if="{{item.canConfirmEntry}}"
          bindtap="onViewQRCode" 
          data-qrcode="{{item.qrCode}}"
        >
          å…¥åœºå‡­è¯
        </view>
        <view 
          class="action-btn entry" 
          wx:if="{{item.canConfirmEntry}}"
          bindtap="onConfirmEntry" 
          data-id="{{item._id}}"
        >
          ç¡®è®¤å…¥åœº
        </view>
        <view 
          class="action-btn exit" 
          wx:if="{{item.canConfirmExit}}"
          bindtap="onConfirmExit" 
          data-id="{{item._id}}"
        >
          ç¡®è®¤å‡ºåœº
        </view>
        <view 
          class="action-btn cancel" 
          wx:if="{{item.canCancel}}"
          bindtap="onCancelRecord" 
          data-id="{{item._id}}"
        >
          å–æ¶ˆ
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-more" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- æ²¡æœ‰æ›´å¤š -->
  <view class="no-more" wx:if="{{!hasMore && records.length > 0}}">
    <text>â€” æ²¡æœ‰æ›´å¤šäº† â€”</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && records.length === 0}}">
    <view class="empty-icon">ğŸš—</view>
    <view class="empty-text">æš‚æ— åœè½¦è®°å½•</view>
    <navigator url="/pages/parking/register/register" open-type="switchTab" class="empty-btn">
      å»ç™»è®°è½¦è¾†
    </navigator>
  </view>
</view>
