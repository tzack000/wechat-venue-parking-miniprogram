# parking-registration Specification

## Purpose
TBD - created by archiving change add-venue-booking-parking-miniprogram. Update Purpose after archive.
## Requirements
### Requirement: 访客车辆登记
系统 SHALL 允许用户登记访客车辆信息，用于进入停车场。

#### Scenario: 成功登记访客车辆
- **GIVEN** 用户已登录
- **WHEN** 用户填写车牌号、访问目的、预计停留时间
- **AND** 提交登记信息
- **THEN** 系统创建停车登记记录
- **AND** 生成登记凭证（二维码或编号）
- **AND** 记录状态为"待入场"

#### Scenario: 车牌号格式校验
- **WHEN** 用户输入车牌号
- **THEN** 系统校验车牌号格式（支持普通车牌和新能源车牌）
- **AND** 格式错误时提示"请输入正确的车牌号"

#### Scenario: 未登录用户登记
- **GIVEN** 用户未登录
- **WHEN** 用户尝试登记车辆
- **THEN** 系统提示用户先登录

### Requirement: 车位预约
系统 SHALL 允许用户提前预约停车位。

#### Scenario: 查看车位状态
- **WHEN** 用户进入车位预约页面
- **THEN** 系统展示停车场车位总数和剩余可预约数量
- **AND** 显示预约规则（最长预约时长、提前时间等）

#### Scenario: 成功预约车位
- **GIVEN** 用户已登录
- **AND** 有可用车位
- **WHEN** 用户填写车牌号、预约时段
- **AND** 提交预约
- **THEN** 系统创建车位预约记录
- **AND** 预约状态为"待入场"
- **AND** 可用车位数量减一

#### Scenario: 车位已满
- **GIVEN** 当前时段无可用车位
- **WHEN** 用户尝试预约
- **THEN** 系统提示"当前时段车位已满，请选择其他时段"

#### Scenario: 取消车位预约
- **GIVEN** 用户有待入场的车位预约
- **AND** 距离预约开始时间大于设定时间
- **WHEN** 用户取消预约
- **THEN** 预约状态更新为"已取消"
- **AND** 释放该车位

### Requirement: 车辆进出记录
系统 SHALL 记录车辆进出停车场的时间。

#### Scenario: 记录车辆入场
- **GIVEN** 车辆有有效的登记或预约记录
- **WHEN** 车辆入场（手动确认或闸机触发）
- **THEN** 系统记录入场时间
- **AND** 更新记录状态为"已入场"

#### Scenario: 记录车辆出场
- **GIVEN** 车辆处于"已入场"状态
- **WHEN** 车辆出场（手动确认或闸机触发）
- **THEN** 系统记录出场时间
- **AND** 计算停车时长
- **AND** 更新记录状态为"已出场"

#### Scenario: 手动确认进出（无闸机）
- **GIVEN** 停车场无自动闸机
- **WHEN** 用户在小程序点击"确认入场"或"确认出场"
- **THEN** 系统记录当前时间为进出时间

### Requirement: 停车记录查询
系统 SHALL 允许用户查询自己的停车历史记录。

#### Scenario: 查看当前停车状态
- **WHEN** 用户进入停车记录页面
- **THEN** 系统优先展示当前在场的车辆记录
- **AND** 显示入场时间、已停时长

#### Scenario: 查看历史停车记录
- **WHEN** 用户查看历史记录
- **THEN** 系统展示所有已完成的停车记录
- **AND** 每条记录显示车牌号、入场时间、出场时间、停车时长
- **AND** 按时间倒序排列

#### Scenario: 筛选停车记录
- **WHEN** 用户按日期范围筛选
- **THEN** 系统只展示该范围内的记录

### Requirement: 停车管理（管理员）
系统 SHALL 允许管理员管理停车登记和记录。

#### Scenario: 查看所有停车记录
- **GIVEN** 用户为管理员
- **WHEN** 管理员进入停车管理页面
- **THEN** 系统展示所有停车记录
- **AND** 支持按状态、日期、车牌号筛选

#### Scenario: 管理员手动登记车辆
- **GIVEN** 用户为管理员
- **WHEN** 管理员为访客手动登记车辆
- **THEN** 系统创建停车记录
- **AND** 无需访客本人操作

#### Scenario: 管理员确认进出
- **GIVEN** 用户为管理员
- **WHEN** 管理员为某车辆确认入场或出场
- **THEN** 系统更新该车辆的进出时间和状态

#### Scenario: 车位管理
- **GIVEN** 用户为管理员
- **WHEN** 管理员修改车位总数或预约规则
- **THEN** 系统更新配置
- **AND** 新规则对后续预约生效

### Requirement: 登记凭证
系统 SHALL 为已登记车辆生成入场凭证。

#### Scenario: 生成入场二维码
- **GIVEN** 用户完成车辆登记或预约
- **WHEN** 用户查看登记详情
- **THEN** 系统展示入场二维码
- **AND** 二维码包含登记ID和车牌信息

#### Scenario: 凭证有效期
- **GIVEN** 登记记录有预计入场时间
- **WHEN** 当前时间超过预计入场时间一定时长（如2小时）
- **AND** 车辆未入场
- **THEN** 登记自动失效
- **AND** 释放预约的车位（如有）

