# Design: 微信小程序场馆预约与停车登记系统

## Context

本项目为新建微信小程序，需要实现体育场馆预约和停车登记两大核心功能。用户通过微信授权登录，管理员通过小程序内管理界面进行后台管理。

### 约束条件
- 必须符合微信小程序开发规范
- 使用微信授权登录体系
- 管理功能集成在小程序内，无需独立Web后台

## Goals / Non-Goals

### Goals
- 提供简洁易用的场馆预约流程
- 支持完整的停车登记流程（访客登记、车位预约、进出记录）
- 管理员可在小程序内完成基础管理操作
- 首版功能简单可用，后续迭代扩展

### Non-Goals
- 不实现支付功能（首版）
- 不实现复杂的权限系统（仅区分普通用户和管理员）
- 不实现Web管理后台
- 不实现短信通知（仅使用微信消息）

## Decisions

### 1. 技术选型
- **决定**: 使用微信云开发作为后端
- **原因**: 
  - 免服务器运维，快速上线
  - 原生支持微信登录
  - 云函数 + 云数据库，开发效率高
  - 成本可控
- **备选方案**: 自建 Node.js + MySQL 服务器（需要更多运维成本）

### 2. 小程序框架
- **决定**: 使用微信原生小程序框架
- **原因**:
  - 性能最优，无额外框架开销
  - 文档完善，社区活跃
  - 项目规模适中，无需复杂框架
- **备选方案**: uni-app（跨端需求时考虑）、Taro（React技术栈时考虑）

### 3. 数据库设计
- **决定**: 使用云数据库（MongoDB风格）
- **集合设计**:
  - `users` - 用户信息
  - `venues` - 场馆信息
  - `bookings` - 预约记录
  - `parking_records` - 停车登记记录
  - `parking_spaces` - 车位信息

### 4. 用户角色
- **决定**: 简单双角色模式
- **普通用户**: 预约场馆、停车登记
- **管理员**: 场馆管理、预约审核、停车记录管理
- **角色判断**: 通过用户表的 `isAdmin` 字段

## Architecture

```
┌─────────────────────────────────────────────────────────┐
│                    微信小程序前端                         │
├─────────────┬─────────────┬─────────────┬──────────────┤
│   首页      │  场馆预约    │  停车登记    │   个人中心    │
│             │  - 场馆列表  │  - 访客登记  │   - 我的预约  │
│             │  - 时段选择  │  - 车位预约  │   - 停车记录  │
│             │  - 预约提交  │  - 进出记录  │   - 管理入口  │
└──────────────────────────┬──────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────┐
│                    微信云开发                            │
├─────────────────────────────────────────────────────────┤
│  云函数                                                  │
│  - user: 用户登录/信息                                   │
│  - venue: 场馆CRUD/查询                                  │
│  - booking: 预约创建/取消/查询                            │
│  - parking: 停车登记/记录查询                             │
├─────────────────────────────────────────────────────────┤
│  云数据库                                                │
│  - users / venues / bookings / parking_records / ...    │
└─────────────────────────────────────────────────────────┘
```

## Page Structure

```
pages/
├── index/              # 首页
├── venue/
│   ├── list/           # 场馆列表
│   ├── detail/         # 场馆详情 & 时段选择
│   └── booking/        # 预约确认
├── parking/
│   ├── register/       # 访客车辆登记
│   ├── reserve/        # 车位预约
│   └── records/        # 进出记录查询
├── user/
│   ├── center/         # 个人中心
│   ├── bookings/       # 我的预约
│   └── parking/        # 我的停车记录
└── admin/
    ├── index/          # 管理首页
    ├── venues/         # 场馆管理
    ├── bookings/       # 预约管理
    └── parking/        # 停车管理
```

## Risks / Trade-offs

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 云开发有并发和存储限制 | 用户量大时可能受限 | 首版足够，后续可迁移到自建后端 |
| 无支付功能 | 无法收取预约费用 | 后续版本添加微信支付 |
| 管理功能在小程序内 | 复杂管理操作不便 | 保持管理功能简单，必要时再建Web后台 |

## Migration Plan

N/A - 新项目，无需迁移

## Open Questions

1. 场馆预约是否需要审核流程，还是直接确认？
2. 停车登记是否需要与闸机系统对接？
3. 是否需要预约/停车的提醒通知功能？
